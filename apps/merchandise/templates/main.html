{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Merchandise</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}


<body class="bg-gray-50 text-gray-800">
  <div class="max-w-7xl mx-auto px-6 py-10">

    <!-- ===== Banner: runner or organizer ===== -->
    {% if user.is_authenticated and is_organizer %}
      <!-- Organizer banner -->
      <div class="bg-white rounded-xl shadow-sm p-6 mb-8 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-yellow-100 flex items-center justify-center">
            <!-- coin icon -->
            <svg class="w-8 h-8 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="8"/>
              <path d="M12 8v8M9 10h6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-lg font-semibold">
              {{ organizer_coins|default:0 }} Coins Earned
            </div>
            <div class="text-sm text-gray-500">From merchandise redemptions</div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <a href="#" class="px-4 py-2 text-sm bg-white border border-gray-200 rounded-full text-gray-600 hover:bg-gray-50">History</a>
          <a href="{% url 'merchandise:add' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-600 text-white hover:bg-indigo-700">
            Add New Product
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      </div>

    {% else %}
      <!-- Runner / default banner -->
      <div class="bg-white rounded-xl shadow-sm p-6 mb-8 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-yellow-100 flex items-center justify-center">
            <svg class="w-8 h-8 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="8"/>
              <path d="M12 8v8M9 10h6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-lg font-semibold">
              {{ user_coins|default:0 }} Coins
            </div>
            <div class="text-sm text-gray-500">Run for rewards! Join a marathon and earn coins</div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <a href="#" class="px-4 py-2 text-sm bg-white border border-gray-200 rounded-full text-gray-600 hover:bg-gray-50">History</a>
          <a href="#" class="text-indigo-600 text-sm hover:underline">Discover Events â†’</a>
        </div>
      </div>
    {% endif %}

    <!-- ===== Section Title + Category Filters ===== -->
    <div class="mb-4">
      <h2 class="text-3xl font-bold mb-4">Merchandise</h2>

      <div class="bg-white rounded-lg p-4 mb-8">
        <div class="flex flex-wrap gap-3">
          <button data-category="all" class="category-btn px-4 py-2 rounded-full bg-indigo-600 text-white text-sm">All</button>

          {% for cat in categories %}
            <button data-category="{{ cat.slug }}" class="category-btn px-4 py-2 rounded-full border border-indigo-200 text-indigo-600 text-sm bg-white hover:bg-indigo-50">
              {{ cat.name }}
            </button>
          {% empty %}
            <!-- fallback hard-coded categories if none exist in DB -->
            <button data-category="apparel" class="category-btn px-4 py-2 rounded-full border border-indigo-200 text-indigo-600 text-sm bg-white hover:bg-indigo-50">Apparel</button>
            <button data-category="accessories" class="category-btn px-4 py-2 rounded-full border border-indigo-200 text-indigo-600 text-sm bg-white hover:bg-indigo-50">Accessories</button>
            <button data-category="totebag" class="category-btn px-4 py-2 rounded-full border border-indigo-200 text-indigo-600 text-sm bg-white hover:bg-indigo-50">Tote Bag</button>
            <button data-category="water-bottle" class="category-btn px-4 py-2 rounded-full border border-indigo-200 text-indigo-600 text-sm bg-white hover:bg-indigo-50">Water Bottle</button>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ===== Grid of cards ===== -->
    <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for product in products %}
        <div class="product-card" data-category="{{ product.category|default:'' }}">
          {% include 'merchandise/card_merchandise.html' with product=product %}
        </div>
      {% empty %}
        <div class="col-span-full bg-white rounded-lg p-8 text-center text-gray-500">
          No merchandise found.
        </div>
      {% endfor %}
    </div>

  </div>

  <!-- ===== Client-side filter script (simple) ===== -->
  <script>
    (function(){
      const buttons = document.querySelectorAll('.category-btn');
      const cards = document.querySelectorAll('#products-grid .product-card');

      function setActive(btn){
        buttons.forEach(b => b.classList.remove('bg-indigo-600','text-white'));
        buttons.forEach(b => b.classList.add('bg-white','text-indigo-600'));
        btn.classList.remove('bg-white','text-indigo-600');
        btn.classList.add('bg-indigo-600','text-white');
      }

      buttons.forEach(btn=>{
        btn.addEventListener('click', () => {
          const cat = btn.getAttribute('data-category');
          setActive(btn);

          cards.forEach(c=>{
            if(cat === 'all' || !cat){
              c.style.display = '';
            } else {
              if(c.dataset.category === cat) c.style.display = '';
              else c.style.display = 'none';
            }
          });

          // smooth scroll to grid on small screens
          document.getElementById('products-grid').scrollIntoView({behavior: 'smooth', block: 'start'});
        });
      });

      // set initial active
      if(buttons[0]) setActive(buttons[0]);
    })();
  </script>
</body>
</html>



{% include 'footer.html' %}
{% endblock content %}

